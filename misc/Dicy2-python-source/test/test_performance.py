from typing import List

from dicy2.corpus_event import Dicy2CorpusEvent
from dicy2.dicy2_time import Dicy2Timepoint
from dicy2.generation_scheduler import Dicy2GenerationScheduler
from dicy2.label import ListLabel
from dicy2.prospector import FactorOracleProspector
from gig.main.corpus import GenericCorpus
from gig.main.influence import Influence
from gig.main.query import InfluenceQuery

if __name__ == '__main__':

    bach_chorale = [(59, [59, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (42, [42, 300, 100]),
                    (50, [50, 300, 100]),
                    (40, [40, 300, 100]),
                    (52, [52, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (45, [45, 300, 100]),
                    (61, [61, 300, 100]),
                    (50, [50, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (38, [38, 300, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (45, [45, 150, 100]),
                    (47, [47, 450, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 450, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 150, 100]),
                    (57, [57, 150, 100]),
                    (50, [50, 150, 100]),
                    (49, [49, 150, 100]),
                    (50, [50, 450, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 150, 100]),
                    (62, [62, 150, 100]),
                    (64, [64, 150, 100]),
                    (66, [66, 150, 100]),
                    (62, [62, 150, 100]),
                    (67, [67, 150, 100]),
                    (66, [66, 150, 100]),
                    (67, [67, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (50, [50, 150, 100]),
                    (55, [55, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (54, [54, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 300, 100]),
                    (40, [40, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (40, [40, 300, 100]),
                    (55, [55, 300, 100]),
                    (45, [45, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (45, [45, 300, 100]),
                    (55, [55, 300, 100]),
                    (54, [54, 150, 100]),
                    (57, [57, 150, 100]),
                    (62, [62, 150, 100]),
                    (66, [66, 150, 100]),
                    (69, [69, 150, 100]),
                    (66, [66, 150, 100]),
                    (62, [62, 150, 100]),
                    (57, [57, 150, 100]),
                    (54, [54, 150, 100]),
                    (57, [57, 150, 100]),
                    (50, [50, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (67, [67, 150, 100]),
                    (71, [71, 150, 100]),
                    (67, [67, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (52, [52, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 300, 100]),
                    (61, [61, 300, 100]),
                    (62, [62, 150, 100]),
                    (57, [57, 150, 100]),
                    (54, [54, 150, 100]),
                    (50, [50, 150, 100]),
                    (57, [57, 300, 100]),
                    (45, [45, 300, 100]),
                    (38, [38, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (61, [61, 150, 100]),
                    (62, [62, 600, 100]),
                    (43, [43, 300, 100]),
                    (59, [59, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (42, [42, 300, 100]),
                    (50, [50, 300, 100]),
                    (40, [40, 300, 100]),
                    (52, [52, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (45, [45, 300, 100]),
                    (61, [61, 300, 100]),
                    (50, [50, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (38, [38, 300, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (45, [45, 150, 100]),
                    (47, [47, 450, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 450, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 150, 100]),
                    (57, [57, 150, 100]),
                    (50, [50, 150, 100]),
                    (49, [49, 150, 100]),
                    (50, [50, 450, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 150, 100]),
                    (62, [62, 150, 100]),
                    (64, [64, 150, 100]),
                    (66, [66, 150, 100]),
                    (62, [62, 150, 100]),
                    (67, [67, 150, 100]),
                    (66, [66, 150, 100]),
                    (67, [67, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (50, [50, 150, 100]),
                    (55, [55, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (55, [55, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (54, [54, 300, 100]),
                    (42, [42, 300, 100]),
                    (54, [54, 300, 100]),
                    (40, [40, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (40, [40, 300, 100]),
                    (55, [55, 300, 100]),
                    (45, [45, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (45, [45, 300, 100]),
                    (55, [55, 300, 100]),
                    (54, [54, 150, 100]),
                    (57, [57, 150, 100]),
                    (62, [62, 150, 100]),
                    (66, [66, 150, 100]),
                    (69, [69, 150, 100]),
                    (66, [66, 150, 100]),
                    (62, [62, 150, 100]),
                    (57, [57, 150, 100]),
                    (54, [54, 150, 100]),
                    (57, [57, 150, 100]),
                    (50, [50, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (67, [67, 150, 100]),
                    (71, [71, 150, 100]),
                    (67, [67, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (52, [52, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 300, 100]),
                    (61, [61, 300, 100]),
                    (62, [62, 150, 100]),
                    (57, [57, 150, 100]),
                    (54, [54, 150, 100]),
                    (50, [50, 150, 100]),
                    (57, [57, 300, 100]),
                    (45, [45, 300, 100]),
                    (38, [38, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 150, 100]),
                    (61, [61, 150, 100]),
                    (62, [62, 600, 100]),
                    (38, [38, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (38, [38, 300, 100]),
                    (54, [54, 300, 100]),
                    (43, [43, 300, 100]),
                    (59, [59, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (59, [59, 300, 100]),
                    (48, [48, 300, 100]),
                    (60, [60, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (60, [60, 300, 100]),
                    (57, [57, 300, 100]),
                    (54, [54, 300, 100]),
                    (51, [51, 150, 100]),
                    (47, [47, 150, 100]),
                    (51, [51, 150, 100]),
                    (54, [54, 150, 100]),
                    (59, [59, 150, 100]),
                    (63, [63, 150, 100]),
                    (66, [66, 150, 100]),
                    (69, [69, 150, 100]),
                    (67, [67, 450, 100]),
                    (66, [66, 150, 100]),
                    (67, [67, 450, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 450, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 450, 100]),
                    (71, [71, 150, 100]),
                    (72, [72, 450, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 450, 100]),
                    (52, [52, 150, 100]),
                    (51, [51, 300, 100]),
                    (57, [57, 300, 100]),
                    (55, [55, 300, 100]),
                    (46, [46, 300, 100]),
                    (47, [47, 300, 100]),
                    (54, [54, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (40, [40, 300, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (52, [52, 150, 100]),
                    (57, [57, 150, 100]),
                    (60, [60, 150, 100]),
                    (64, [64, 150, 100]),
                    (60, [60, 150, 100]),
                    (57, [57, 150, 100]),
                    (52, [52, 150, 100]),
                    (48, [48, 150, 100]),
                    (52, [52, 150, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (50, [50, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (45, [45, 300, 100]),
                    (48, [48, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (54, [54, 300, 100]),
                    (52, [52, 300, 100]),
                    (50, [50, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (60, [60, 300, 100]),
                    (59, [59, 300, 100]),
                    (57, [57, 300, 100]),
                    (55, [55, 300, 100]),
                    (59, [59, 300, 100]),
                    (62, [62, 300, 100]),
                    (65, [65, 300, 100]),
                    (64, [64, 300, 100]),
                    (62, [62, 300, 100]),
                    (60, [60, 300, 100]),
                    (64, [64, 300, 100]),
                    (66, [66, 300, 100]),
                    (68, [68, 300, 100]),
                    (69, [69, 300, 100]),
                    (67, [67, 300, 100]),
                    (66, [66, 300, 100]),
                    (62, [62, 300, 100]),
                    (67, [67, 300, 100]),
                    (55, [55, 300, 100]),
                    (62, [62, 300, 100]),
                    (50, [50, 300, 100]),
                    (55, [55, 150, 100]),
                    (43, [43, 150, 100]),
                    (45, [45, 150, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 600, 100]),
                    (38, [38, 300, 100]),
                    (54, [54, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 300, 100]),
                    (50, [50, 300, 100]),
                    (38, [38, 300, 100]),
                    (54, [54, 300, 100]),
                    (43, [43, 300, 100]),
                    (59, [59, 150, 100]),
                    (57, [57, 150, 100]),
                    (59, [59, 300, 100]),
                    (55, [55, 300, 100]),
                    (43, [43, 300, 100]),
                    (59, [59, 300, 100]),
                    (48, [48, 300, 100]),
                    (60, [60, 150, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (60, [60, 300, 100]),
                    (57, [57, 300, 100]),
                    (54, [54, 300, 100]),
                    (51, [51, 150, 100]),
                    (47, [47, 150, 100]),
                    (51, [51, 150, 100]),
                    (54, [54, 150, 100]),
                    (59, [59, 150, 100]),
                    (63, [63, 150, 100]),
                    (66, [66, 150, 100]),
                    (69, [69, 150, 100]),
                    (67, [67, 450, 100]),
                    (66, [66, 150, 100]),
                    (67, [67, 450, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 450, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 450, 100]),
                    (71, [71, 150, 100]),
                    (72, [72, 450, 100]),
                    (59, [59, 150, 100]),
                    (60, [60, 450, 100]),
                    (52, [52, 150, 100]),
                    (51, [51, 300, 100]),
                    (57, [57, 300, 100]),
                    (55, [55, 300, 100]),
                    (46, [46, 300, 100]),
                    (47, [47, 300, 100]),
                    (54, [54, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 300, 100]),
                    (52, [52, 300, 100]),
                    (40, [40, 300, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (52, [52, 150, 100]),
                    (57, [57, 150, 100]),
                    (60, [60, 150, 100]),
                    (64, [64, 150, 100]),
                    (60, [60, 150, 100]),
                    (57, [57, 150, 100]),
                    (52, [52, 150, 100]),
                    (48, [48, 150, 100]),
                    (52, [52, 150, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (55, [55, 150, 100]),
                    (59, [59, 150, 100]),
                    (62, [62, 150, 100]),
                    (59, [59, 150, 100]),
                    (55, [55, 150, 100]),
                    (50, [50, 150, 100]),
                    (47, [47, 150, 100]),
                    (50, [50, 150, 100]),
                    (48, [48, 150, 100]),
                    (47, [47, 150, 100]),
                    (45, [45, 300, 100]),
                    (48, [48, 300, 100]),
                    (52, [52, 300, 100]),
                    (55, [55, 300, 100]),
                    (54, [54, 300, 100]),
                    (52, [52, 300, 100]),
                    (50, [50, 300, 100]),
                    (54, [54, 300, 100]),
                    (57, [57, 300, 100]),
                    (60, [60, 300, 100]),
                    (59, [59, 300, 100]),
                    (57, [57, 300, 100]),
                    (55, [55, 300, 100]),
                    (59, [59, 300, 100]),
                    (62, [62, 300, 100]),
                    (65, [65, 300, 100]),
                    (64, [64, 300, 100]),
                    (62, [62, 300, 100]),
                    (60, [60, 300, 100]),
                    (64, [64, 300, 100]),
                    (66, [66, 300, 100]),
                    (68, [68, 300, 100]),
                    (69, [69, 300, 100]),
                    (67, [67, 300, 100]),
                    (66, [66, 300, 100]),
                    (62, [62, 300, 100]),
                    (67, [67, 300, 100]),
                    (55, [55, 300, 100]),
                    (62, [62, 300, 100]),
                    (50, [50, 300, 100]),
                    (55, [55, 150, 100]),
                    (43, [43, 150, 100]),
                    (45, [45, 150, 100]),
                    (47, [47, 150, 100]),
                    (48, [48, 150, 100]),
                    (50, [50, 150, 100]),
                    (52, [52, 150, 100]),
                    (54, [54, 150, 100]),
                    (55, [55, 1250, 100])]

    gs: Dicy2GenerationScheduler = Dicy2GenerationScheduler(
        FactorOracleProspector(corpus=GenericCorpus([], label_types=[ListLabel]), label_type=ListLabel))
    for i, (label, event) in enumerate(bach_chorale):
        gs.learn_event(Dicy2CorpusEvent(event, i, ListLabel.parse(label)))

    labels: List[ListLabel] = [ListLabel([e]) for e in [66, None, None, None, None, None, None, None, None, 79]]

    query = InfluenceQuery(content=Influence.from_labels(labels), time=Dicy2Timepoint())
    from timeit import default_timer as timer

    start = timer()
    output = []
    n_queries = 1000
    for i in range(n_queries):
        gs.process_query(query)
        output.append(gs.generation_process.last_sequence())

    end = timer()
    print(output)
    print(f"time: {end - start:.2f} seconds (per query: {(end - start)/n_queries * 1000:.2f} milliseconds)")





